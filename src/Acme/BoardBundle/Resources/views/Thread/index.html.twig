{% extends 'AcmeBoardBundle::layout.html.twig' %}
{% use '::page.html.twig' %}
{% block body %}
<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
<ol class="breadcrumb">
  <li><a href="/">Home</a></li>
  <li><a href="{{ path('module_index') }}">Board</a></li>
  <li class="dropdown"><a href="{{ path('module_index') }}#{{ module.id }}" data-target="#" data-toggle="dropdown">{{ module.parent.name }}</a>
    <ul class="dropdown-menu">
      {% for child in module.parent.children %}
        <li role="presentation"><a role="menuitem" tabindex="-1" href="{{ path('thread_index', {'module_id': child.id}) }}">{{ child.name }}</a></li>       
      {% endfor %}
    </ul>
  </li>
  <li class="active">{{ module.name }}</li>  
</ol>
<div class="page-header">
  <h1>{{ module.name }} <small>Subtext for header</small></h1>
</div>
<div><a href="{{ path('thread_create', {'module_id': app.request.get('module_id')}) }}">
  <button class="btn btn-primary"><!-- <span class="glyphicon glyphicon-plus"></span> --><strong>CREATE THREAD</strong></button></a>
</div>
<div class="table-condensed">
  <table class="table table-hover">
    <thead>
      <tr>
        <th style="width: 5%">#</th>
        <th style="width: 55%">Subject</th>
        <th style="width: 15%">Author</th>
        <th style="width: 5%">Replies</th>
        <th style="width: 5%">Views</th>        
        <th style="width: 15%">Last Post</th>
      </tr>
    </thead>
    <tbody>
      {% for thread in pagination %}
      <tr>
        <td><span class="thread_id hidden">{{ thread.id }}</span></td>
        <td>{% if thread.status == 0 %}<span class="label label-default">Default</span>{% endif %}
        <a href="{{ path('thread_view', {'id': thread.id}) }}" data-toggle="tooltip" title="{{ thread.content }}">{{ thread.title|truncate(40) }}</a></td>
        <td>{{ thread.user.username }} </td>      
        <td><span class="">{{ thread.numReplies }}</span></td>    
        <td>{{ thread.numViews }}</td>  
        <td>{{ thread.updatedAt|time_ago_in_words }}</td>                  
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% block pagingwrapper %}
  {{ parent() }}
{% endblock %}
<input type="hidden" id="module_id" value="{{ module.id }}" />
<!-- <button class="btn btn-test">test</button> -->
<script>
// TODO
var retval = [];
$("tbody span.thread_id").each(function () {
  retval.push($(this).html());
});

console.log(retval);

var path = Routing.generate('comment_check');

$('.btn-test').click(function () {
  var btn = $(this);
  $.ajax({
    type: "GET",
    url: path,
    dataType: "json",
    data: { module_id: $("#module_id").val(), id: 1 }
  }).done(function(data) {
    if (data.code == 100 && data.success) {
      $.each(data.comments, function(key, val) {   
        /*
        var $div = $("<div>", {id: "foo", class: "a"});
        $div.text(val.thread.id);
        $("body").prepend($div);
        */
      });
    }
  }).fail(function() {
  }).always(function () {
  });
});
</script>

{% endblock %}
